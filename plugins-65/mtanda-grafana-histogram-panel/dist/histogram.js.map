{"version":3,"sources":["../src/histogram.js"],"names":[],"mappings":"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","file":"histogram.js","sourcesContent":["import angular from 'angular';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport HistogramTooltip from './histogram_tooltip.js';\nimport 'jquery.flot';\nimport 'jquery.flot.selection';\nimport 'jquery.flot.time';\nimport 'jquery.flot.stack';\nimport 'jquery.flot.stackpercent';\nimport 'jquery.flot.fillbelow';\nimport 'jquery.flot.crosshair';\nimport 'app/plugins/panel/graph/jquery.flot.events';\n\nangular.module('grafana.directives').directive('grafanaHistogram', function($rootScope, timeSrv) {\n  return {\n    restrict: 'A',\n    template: '<div> </div>',\n    link: function(scope, elem) {\n      var ctrl = scope.ctrl;\n      var dashboard = ctrl.dashboard;\n      var panel = ctrl.panel;\n      var data, annotations;\n      var sortedSeries;\n      var legendSideLastValue = null;\n      var rootScope = scope.$root;\n\n      rootScope.onAppEvent('setCrosshair', function(event, info) {\n        // do not need to to this if event is from this panel\n        if (info.scope === scope) {\n          return;\n        }\n\n        if(dashboard.sharedCrosshair) {\n          var plot = elem.data().plot;\n          if (plot) {\n            plot.setCrosshair({ x: info.pos.x, y: info.pos.y });\n          }\n        }\n      }, scope);\n\n      rootScope.onAppEvent('clearCrosshair', function() {\n        var plot = elem.data().plot;\n        if (plot) {\n          plot.clearCrosshair();\n        }\n      }, scope);\n\n      // Receive render events\n      ctrl.events.on('render', function(renderData) {\n        data = renderData || data;\n        if (!data) {\n          ctrl.refresh();\n          return;\n        }\n        annotations = data.annotations || annotations;\n        render_panel();\n      });\n\n      function getLegendHeight(panelHeight) {\n        if (!panel.legend.show || panel.legend.rightSide) {\n          return 2;\n        }\n\n        if (panel.legend.alignAsTable) {\n          var legendSeries = _.filter(data, function(series) {\n            return series.hideFromLegend(panel.legend) === false;\n          });\n          var total = 23 + (22 * legendSeries.length);\n          return Math.min(total, Math.floor(panelHeight/2));\n        } else {\n          return 26;\n        }\n      }\n\n      function setElementHeight() {\n        try {\n          var height = ctrl.height - getLegendHeight(ctrl.height);\n          elem.css('height', height + 'px');\n\n          return true;\n        } catch(e) { // IE throws errors sometimes\n          console.log(e);\n          return false;\n        }\n      }\n\n      function shouldAbortRender() {\n        if (!data) {\n          return true;\n        }\n\n        if (!setElementHeight()) { return true; }\n\n        if(_.isString(data)) {\n          render_panel_as_graphite_png(data);\n          return true;\n        }\n\n        if (elem.width() === 0) {\n          return true;\n        }\n      }\n\n      function drawHook(plot) {\n        // Update legend values\n        var yaxis = plot.getYAxes();\n        for (var i = 0; i < data.length; i++) {\n          var series = data[i];\n          var axis = yaxis[series.yaxis - 1];\n          var formater = kbn.valueFormats[panel.yaxes[series.yaxis - 1].format];\n\n          // decimal override\n          if (_.isNumber(panel.decimals)) {\n            series.updateLegendValues(formater, panel.decimals, null);\n          } else {\n            // auto decimals\n            // legend and tooltip gets one more decimal precision\n            // than graph legend ticks\n            var tickDecimals = (axis.tickDecimals || -1) + 1;\n            series.updateLegendValues(formater, tickDecimals, axis.scaledDecimals + 2);\n          }\n\n          if(!rootScope.$$phase) { scope.$digest(); }\n        }\n\n        // add left axis labels\n        if (panel.yaxes[0].label) {\n          var yaxisLabel = $(\"<div class='axisLabel left-yaxis-label'></div>\")\n            .text(panel.yaxes[0].label)\n            .appendTo(elem);\n\n          yaxisLabel.css(\"margin-top\", yaxisLabel.width() / 2);\n        }\n\n        // add right axis labels\n        if (panel.yaxes[1].label) {\n          var rightLabel = $(\"<div class='axisLabel right-yaxis-label'></div>\")\n            .text(panel.yaxes[1].label)\n            .appendTo(elem);\n\n          rightLabel.css(\"margin-top\", rightLabel.width() / 2);\n        }\n      }\n\n      function processOffsetHook(plot, gridMargin) {\n        var left = panel.yaxes[0];\n        var right = panel.yaxes[1];\n        if (left.show && left.label) { gridMargin.left = 20; }\n        if (right.show && right.label) { gridMargin.right = 20; }\n      }\n\n      function getHistogramPairs(series, fillStyle, bucketSize, minValue, maxValue) {        \n        if (bucketSize === null || bucketSize <= 0) {\n          bucketSize = 1;\n        }\n\t\n        series.yaxis = 1; // TODO check\n        series.stats.total = 0;\n        series.stats.max = Number.MIN_VALUE;\n        series.stats.min = Number.MAX_VALUE;\n        series.stats.avg = null;\n        series.stats.current = null;\n        var ignoreNulls = fillStyle === 'connected' || fillStyle === 'null';\n        var nullAsZero = fillStyle === 'null as zero';\n        var values = {};\n        var currentValue;\n        var filterMin = false;\n        var filterMax = false;\n        if (_.isNumber(minValue) && !isNaN(minValue)) {\n          values[minValue] = [minValue, 0];\n          filterMin = true;\n        }\n        if (_.isNumber(maxValue) && !isNaN(maxValue)) {\n          values[maxValue] = [maxValue, 0];\n          filterMax = true;\n        }\n        for (var i = 0; i < series.datapoints.length; i++) {\n          currentValue = series.datapoints[i][0];\n          if (currentValue === null) {\n            if (ignoreNulls) { continue; }\n            if (nullAsZero) {\n              currentValue = 0;\n            }\n          }\n          if (_.isNumber(currentValue)) {\n            series.stats.total += currentValue;\n          }\n          if (currentValue > series.stats.max) {\n            series.stats.max = currentValue;\n          }\n          if (currentValue < series.stats.min) {\n            series.stats.min = currentValue;\n          }\n          if(filterMin && currentValue < minValue) continue;\n          if(filterMax && currentValue > maxValue) continue;\n\n          var bucket = Math.floor(currentValue / bucketSize) * bucketSize;\n          if (bucket in values) {\n            values[bucket][1]++;\n          } else {\n            values[bucket] = [bucket, 1];\n          }\n        }\t\t\n\t\t\n        var result = _.sortBy(values, x => x[0]);\t\t\t\n        series.stats.timeStep = bucketSize;\n        if (series.stats.max === Number.MIN_VALUE) { series.stats.max = null; }\n        if (series.stats.min === Number.MAX_VALUE) { series.stats.min = null; }\n        if (result.length) {\n          var count = _.reduce(_.values(values), function(memo, num) { return memo + num; }, 0);\n          series.stats.avg = series.stats.total / count;\n          series.stats.current = currentValue;\n        }\n        series.stats.count = result.length;\n        return result;\n      }\n\n      // Function for rendering panel\n      function render_panel() {\n        if (shouldAbortRender()) {\n          return;\n        }\n\n        var stack = panel.stack ? true : null;\n\n        // Populate element\n        var options = {\n          hooks: {\n            draw: [drawHook],\n            processOffset: [processOffsetHook],\n          },\n          legend: { show: false },\n          series: {\n            stackpercent: panel.stack ? panel.percentage : false,\n            stack: panel.percentage ? null : stack,\n            bars:   {\n              show: true,\n              fill: 1,\n              barWidth: 1,\n              zero: false,\n              lineWidth: 0,\n              align: 'center'\n            },\n            shadowSize: 0\n          },\n          yaxes: [],\n          xaxis: {},\n          grid: {\n            minBorderMargin: 0,\n            markings: [],\n            backgroundColor: null,\n            borderWidth: 0,\n            hoverable: true,\n            color: '#c8c8c8',\n            margin: { left: 0, right: 0 },\n          },\n          selection: {\n            mode: \"x\",\n            color: '#666'\n          },\n          crosshair: {\n            mode: panel.tooltip.shared || dashboard.sharedCrosshair ? \"x\" : null\n          }\n        };\n\n        var scopedVars = ctrl.panel.scopedVars;\n        var bucketSize = !panel.bucketSize && panel.bucketSize !== 0 ? null : parseFloat(ctrl.templateSrv.replaceWithText(panel.bucketSize.toString(), scopedVars));\n        var minValue = !panel.minValue && panel.minValue !== 0 ? null : parseFloat(ctrl.templateSrv.replaceWithText(panel.minValue.toString(), scopedVars));\n        var maxValue = !panel.maxValue && panel.maxValue !== 0 ? null : parseFloat(ctrl.templateSrv.replaceWithText(panel.maxValue.toString(), scopedVars));\n\n        switch(panel.bucketMode) {\n          case 'count':\n            bucketSize = (maxValue - minValue) / bucketSize;\n            break;\n        }\n\n        for (var i = 0; i < data.length; i++) {\n          var series = data[i];\n          series.data = getHistogramPairs(series, series.nullPointMode || panel.nullPointMode, bucketSize || 1, minValue, maxValue);\n\n          // if hidden remove points and disable stack\n          if (ctrl.hiddenSeries[series.alias]) {\n            series.data = [];\n            series.stack = false;\n          }\n        }\n\n        if (data.length && data[0].stats.timeStep) {\n          options.series.bars.barWidth = data[0].stats.timeStep / 1.5;\n        }\n\n        addHistogramAxis(options);\n        options.selection = {};\n\n        sortedSeries = _.sortBy(data, function(series) { return series.zindex; });\n\n        function callPlot(incrementRenderCounter) {\n          try {\n            $.plot(elem, sortedSeries, options);\n          } catch (e) {\n            console.log('flotcharts error', e);\n          }\n\n          if (incrementRenderCounter) {\n            ctrl.renderingCompleted();\n          }\n        }\n\n        if (shouldDelayDraw(panel)) {\n          // temp fix for legends on the side, need to render twice to get dimensions right\n          callPlot(false);\n          setTimeout(function() { callPlot(true); }, 50);\n          legendSideLastValue = panel.legend.rightSide;\n        }\n        else {\n          callPlot(true);\n        }\n      }\n\n      function translateFillOption(fill) {\n        return fill === 0 ? 0.001 : fill/10;\n      }\n\n      function shouldDelayDraw(panel) {\n        if (panel.legend.rightSide) {\n          return true;\n        }\n        if (legendSideLastValue !== null && panel.legend.rightSide !== legendSideLastValue) {\n          return true;\n        }\n      }\n\n      function addHistogramAxis(options) {\n        options.xaxis = {\n          show: panel['x-axis'],\n          label: \"Values\"\n        };\n      }\n\n      function applyLogScale(axis, data) {\n        if (axis.logBase === 1) {\n          return;\n        }\n\n        var series, i;\n        var max = axis.max;\n\n        if (max === null) {\n          for (i = 0; i < data.length; i++) {\n            series = data[i];\n            if (series.yaxis === axis.index) {\n              if (max < series.stats.max) {\n                max = series.stats.max;\n              }\n            }\n          }\n          if (max === void 0) {\n            max = Number.MAX_VALUE;\n          }\n        }\n\n        axis.min = axis.min !== null ? axis.min : 0;\n        axis.ticks = [0, 1];\n        var nextTick = 1;\n\n        while (true) {\n          nextTick = nextTick * axis.logBase;\n          axis.ticks.push(nextTick);\n          if (nextTick > max) {\n            break;\n          }\n        }\n\n        if (axis.logBase === 10) {\n          axis.transform = function(v) { return Math.log(v+0.1); };\n          axis.inverseTransform  = function (v) { return Math.pow(10,v); };\n        } else {\n          axis.transform = function(v) { return Math.log(v+0.1) / Math.log(axis.logBase); };\n          axis.inverseTransform  = function (v) { return Math.pow(axis.logBase,v); };\n        }\n      }\n\n      function configureAxisMode(axis, format) {\n        axis.tickFormatter = function(val, axis) {\n          return kbn.valueFormats[format](val, axis.tickDecimals, axis.scaledDecimals);\n        };\n      }\n\n      function time_format(ticks, min, max) {\n        if (min && max && ticks) {\n          var range = max - min;\n          var secPerTick = (range/ticks) / 1000;\n          var oneDay = 86400000;\n          var oneYear = 31536000000;\n\n          if (secPerTick <= 45) {\n            return \"%H:%M:%S\";\n          }\n          if (secPerTick <= 7200 || range <= oneDay) {\n            return \"%H:%M\";\n          }\n          if (secPerTick <= 80000) {\n            return \"%m/%d %H:%M\";\n          }\n          if (secPerTick <= 2419200 || range <= oneYear) {\n            return \"%m/%d\";\n          }\n          return \"%Y-%m\";\n        }\n\n        return \"%H:%M\";\n      }\n\n      function render_panel_as_graphite_png(url) {\n        url += '&width=' + elem.width();\n        url += '&height=' + elem.css('height').replace('px', '');\n        url += '&bgcolor=1f1f1f'; // @grayDarker & @grafanaPanelBackground\n        url += '&fgcolor=BBBFC2'; // @textColor & @grayLighter\n        url += panel.stack ? '&areaMode=stacked' : '';\n        url += panel.fill !== 0 ? ('&areaAlpha=' + (panel.fill/10).toFixed(1)) : '';\n        url += panel.linewidth !== 0 ? '&lineWidth=' + panel.linewidth : '';\n        url += panel.legend.show ? '&hideLegend=false' : '&hideLegend=true';\n        url += panel.grid.leftMin !== null ? '&yMin=' + panel.grid.leftMin : '';\n        url += panel.grid.leftMax !== null ? '&yMax=' + panel.grid.leftMax : '';\n        url += panel.grid.rightMin !== null ? '&yMin=' + panel.grid.rightMin : '';\n        url += panel.grid.rightMax !== null ? '&yMax=' + panel.grid.rightMax : '';\n        url += panel['x-axis'] ? '' : '&hideAxes=true';\n        url += panel['y-axis'] ? '' : '&hideYAxis=true';\n\n        switch(panel.yaxes[0].format) {\n          case 'bytes':\n            url += '&yUnitSystem=binary';\n            break;\n          case 'bits':\n            url += '&yUnitSystem=binary';\n            break;\n          case 'bps':\n            url += '&yUnitSystem=si';\n            break;\n          case 'pps':\n            url += '&yUnitSystem=si';\n            break;\n          case 'Bps':\n            url += '&yUnitSystem=si';\n            break;\n          case 'short':\n            url += '&yUnitSystem=si';\n            break;\n          case 'joule':\n            url += '&yUnitSystem=si';\n            break;\n          case 'watt':\n            url += '&yUnitSystem=si';\n            break;\n          case 'ev':\n            url += '&yUnitSystem=si';\n            break;\n          case 'none':\n            url += '&yUnitSystem=none';\n            break;\n        }\n\n        switch(panel.nullPointMode) {\n          case 'connected':\n            url += '&lineMode=connected';\n            break;\n          case 'null':\n            break; // graphite default lineMode\n          case 'null as zero':\n            url += \"&drawNullAsZero=true\";\n            break;\n        }\n\n        url += panel.steppedLine ? '&lineMode=staircase' : '';\n\n        elem.html('<img src=\"' + url + '\"></img>');\n      }\n\n      new HistogramTooltip(elem, dashboard, scope, function() {\n        return sortedSeries;\n      });\n\n      elem.bind(\"plotselected\", function (event, ranges) {\n        scope.$apply(function() {\n          timeSrv.setTime({\n            from  : moment.utc(ranges.xaxis.from),\n            to    : moment.utc(ranges.xaxis.to),\n          });\n        });\n      });\n    }\n  };\n});\n"]}