{"version":3,"sources":["../src/histogram_tooltip.js"],"names":[],"mappings":"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","file":"histogram_tooltip.js","sourcesContent":["import $ from 'jquery';\n\nexport default function HistogramTooltip(elem, dashboard, scope, getSeriesFn) {\n  var self = this;\n  var ctrl = scope.ctrl;\n  var panel = ctrl.panel;\n\n  var $tooltip = $('<div id=\"tooltip\" class=\"graph-tooltip\">');\n\n  this.findHoverIndexFromDataPoints = function(posX, series, last) {\n    var ps = series.datapoints.pointsize;\n    var initial = last*ps;\n    var len = series.datapoints.points.length;\n    for (var j = initial; j < len; j += ps) {\n      if (series.datapoints.points[j] > posX) {\n        return Math.max(j - ps,  0)/ps;\n      }\n    }\n    return j/ps - 1;\n  };\n\n  this.findHoverIndexFromData = function(posX, series) {\n    posX = posX + series.bars.barWidth / 2;\n    var len = series.data.length;\n    for (var j = 0; j < len; j++) {\n      if (series.data[j][0] > posX) {\n        return Math.max(j - 1,  0);\n      }\n    }\n    return j - 1;\n  };\n\n  this.showTooltip = function(title, innerHtml, pos) {\n    var body = '<div class=\"graph-tooltip-time\">'+ title + '</div>';\n    body += innerHtml + '</div>';\n    $tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n  };\n\n  this.getMultiSeriesPlotHoverInfo = function(seriesList, pos) {\n    var value, i, series, hoverIndex;\n    var results = [];\n\n    //now we know the current X (j) position for X and Y values\n    var last_value = 0; //needed for stacked values\n\n    for (i = 0; i < seriesList.length; i++) {\n      series = seriesList[i];\n\n      if (!series.data.length || (panel.legend.hideEmpty && series.allIsNull)) {\n        results.push({ hidden: true });\n        continue;\n      }\n\n      if (!series.data.length || (panel.legend.hideZero && series.allIsZero)) {\n        results.push({ hidden: true });\n        continue;\n      }\n\n      hoverIndex = this.findHoverIndexFromData(pos.x, series);\n      results.time = series.data[hoverIndex][0];\n\n      if (series.stack) {\n        if (panel.tooltip.value_type === 'individual') {\n          value = series.data[hoverIndex][1];\n        } else if (!series.stack) {\n          value = series.data[hoverIndex][1];\n        } else {\n          last_value += series.data[hoverIndex][1];\n          value = last_value;\n        }\n      } else {\n        value = series.data[hoverIndex][1];\n      }\n\n      // Highlighting multiple Points depending on the plot type\n      if (series.lines.steps || series.stack) {\n        // stacked and steppedLine plots can have series with different length.\n        // Stacked series can increase its length on each new stacked serie if null points found,\n        // to speed the index search we begin always on the last found hoverIndex.\n        var newhoverIndex = this.findHoverIndexFromDataPoints(pos.x, series, hoverIndex);\n        results.push({ value: value, hoverIndex: newhoverIndex });\n      } else {\n        results.push({ value: value, hoverIndex: hoverIndex });\n      }\n    }\n\n    return results;\n  };\n\n  elem.mouseleave(function () {\n    if (panel.tooltip.shared) {\n      var plot = elem.data().plot;\n      if (plot) {\n        $tooltip.detach();\n        plot.unhighlight();\n      }\n    }\n\n    if (dashboard.sharedCrosshair) {\n      ctrl.publishAppEvent('clearCrosshair');\n    }\n  });\n\n  elem.bind(\"plothover\", function (event, pos, item) {\n    var plot = elem.data().plot;\n    var plotData = plot.getData();\n    var seriesList = getSeriesFn();\n    var group, value, hoverInfo, i, series, seriesHtml, tooltipFormat;\n\n    if (panel.tooltip.msResolution) {\n      tooltipFormat = 'YYYY-MM-DD HH:mm:ss.SSS';\n    } else {\n      tooltipFormat = 'YYYY-MM-DD HH:mm:ss';\n    }\n\n    if (dashboard.sharedCrosshair) {\n      ctrl.publishAppEvent('setCrosshair', { pos: pos, scope: scope });\n    }\n\n    if (seriesList.length === 0) {\n      return;\n    }\n\n    if (panel.tooltip.shared) {\n      plot.unhighlight();\n\n      var seriesHoverInfo = self.getMultiSeriesPlotHoverInfo(plotData, pos);\n\n      seriesHtml = '';\n\n      for (i = 0; i < seriesHoverInfo.length; i++) {\n        hoverInfo = seriesHoverInfo[i];\n\n        if (hoverInfo.hidden) {\n          continue;\n        }\n\n        var highlightClass = '';\n        if (item && i === item.seriesIndex) {\n          highlightClass = 'graph-tooltip-list-item--highlight';\n        }\n\n        series = seriesList[i];\n\n        value = series.formatValue(hoverInfo.value);\n\n        seriesHtml += '<div class=\"graph-tooltip-list-item ' + highlightClass + '\"><div class=\"graph-tooltip-series-name\">';\n        seriesHtml += '<i class=\"fa fa-minus\" style=\"color:' + series.color +';\"></i> ' + series.label + ':</div>';\n        seriesHtml += '<div class=\"graph-tooltip-value\">' + value + '</div></div>';\n        plot.highlight(i, hoverInfo.hoverIndex);\n      }\n\n      self.showTooltip(seriesHoverInfo.time, seriesHtml, pos);\n    }\n    // single series tooltip\n    else if (item) {\n      series = seriesList[item.seriesIndex];\n      group = '<div class=\"graph-tooltip-list-item\"><div class=\"graph-tooltip-series-name\">';\n      group += '<i class=\"fa fa-minus\" style=\"color:' + item.series.color +';\"></i> ' + series.label + ':</div>';\n\n      if (panel.stack && panel.tooltip.value_type === 'individual') {\n        value = item.datapoint[1] - item.datapoint[2];\n      }\n      else {\n        value = item.datapoint[1];\n      }\n\n      value = series.formatValue(value);\n\n      group += '<div class=\"graph-tooltip-value\">' + value + '</div>';\n\n      self.showTooltip(item.datapoint[0], group, pos);\n    }\n    // no hit\n    else {\n      $tooltip.detach();\n    }\n  });\n}\n"]}